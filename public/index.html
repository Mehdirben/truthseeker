<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palestine News Source Comparison Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3B82F6;
            --primary-dark: #2563EB;
            --primary-light: #DBEAFE;
            --secondary: #10B981;
            --secondary-dark: #059669;
            --tertiary: #8B5CF6;
            --danger: #EF4444;
            --warning: #F59E0B;
            --success: #10B981;
            --info: #3B82F6;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --card-shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition-speed: 0.2s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: linear-gradient(135deg, #f6f8fc 0%, #f0f4fa 100%);
            min-height: 100vh;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2.5rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(219,234,254,0.3) 0%, rgba(59,130,246,0.05) 50%, transparent 70%);
            z-index: -1;
            animation: pulse 15s infinite alternate;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(1.05);
            }
        }

        .header h1 {
            font-size: 2.75rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, var(--primary), var(--tertiary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
            position: relative;
            display: inline-block;
        }

        .header p {
            font-size: 1.25rem;
            opacity: 0.9;
            max-width: 600px;
            color: var(--gray-600);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            background: var(--primary-dark);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: var(--secondary-dark);
        }

        .btn-tertiary {
            background: var(--tertiary);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary-light);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .dashboard-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow-hover);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            background: var(--gray-100);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            text-align: center;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
            margin-bottom: 0.5rem;
            font-family: 'Poppins', sans-serif;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .article-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            transition: all var(--transition-speed) ease;
            border-left: 4px solid var(--primary);
            overflow: hidden;
        }

        .article-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .article-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .article-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .article-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .badge {
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .badge-primary {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .article-body {
            padding: 1.25rem;
        }

        .article-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color var(--transition-speed);
            background-color: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }

        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--gray-500);
            font-style: italic;
        }

        .spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            border-bottom: 2px solid transparent;
            color: var(--gray-500);
            cursor: pointer;
            transition: all var(--transition-speed);
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab:hover:not(.active) {
            color: var(--gray-700);
            background-color: var(--gray-100);
        }

        .social-post {
            background: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 1rem;
        }

        .social-post-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
        }

        .platform-icon {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--primary-light);
            color: var(--primary);
            margin-right: 0.75rem;
        }

        .platform-name {
            font-weight: 600;
            color: var(--gray-700);
        }

        .social-post-body {
            padding: 1.25rem;
            white-space: pre-wrap;
        }

        .social-post-footer {
            padding: 0.75rem 1.25rem;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hashtags {
            color: var(--primary);
            margin-top: 0.75rem;
            font-weight: 500;
        }

        .char-count {
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .warning-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .warning-icon {
            flex-shrink: 0;
            margin-top: 0.125rem;
        }

        .warning-high {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--danger);
        }

        .warning-medium {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
        }

        .warning-low {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--info);
        }

        .copy-btn {
            background: var(--primary-light);
            color: var(--primary-dark);
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-weight: 500;
        }

        .copy-btn:hover {
            background: var(--primary);
            color: white;
        }

        @media (max-width: 768px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .article-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .credential-meter {
            height: 6px;
            width: 100%;
            background-color: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .credential-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .credential-high {
            background-color: var(--success);
        }

        .credential-medium {
            background-color: var(--warning);
        }

        .credential-low {
            background-color: var(--danger);
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.25rem;
            color: var(--gray-800);
        }

        .section-icon {
            color: var(--primary);
        }

        /* Status items styling */
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            color: var(--gray-600);
        }

        .status-value {
            font-weight: 600;
            color: var(--gray-800);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Summary styling for news section */
        .news-summary {
            animation: fadeIn 0.5s ease-in;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
            background: var(--gray-100);
            padding: 1.5rem;
            border-radius: 0.75rem;
        }

        .summary-stat {
            text-align: center;
        }

        .summary-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
            font-family: 'Poppins', sans-serif;
        }

        .summary-stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .summary-article {
            background: white;
            border-left: 4px solid var(--primary);
            padding: 1.25rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .summary-article:hover {
            background: var(--primary-light);
            transform: translateX(5px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .summary-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--gray-800);
        }

        .summary-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .summary-source {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .risk-badge, .credibility-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-high {
            background: var(--danger);
            color: white;
        }

        .risk-medium {
            background: var(--warning);
            color: white;
        }

        .risk-low {
            background: var(--success);
            color: white;
        }

        .credibility-high {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .credibility-medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .credibility-low {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .verification-status {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .verified {
            background: var(--success);
            color: white;
        }

        .disputed {
            background: var(--warning);
            color: white;
        }

        .unverified {
            background: var(--gray-400);
            color: white;
        }

        .summary-details {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--gray-200);
        }

        .summary-verification {
            color: var(--info);
            font-size: 0.875rem;
            margin: 0.5rem 0;
        }

        .summary-concerns {
            color: var(--danger);
            font-size: 0.875rem;
            margin: 0.5rem 0;
        }

        .expand-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: inline-block;
            transition: color var(--transition-speed);
        }

        .expand-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* Article cards for both news and fact-checks */
        .article {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            transition: all var(--transition-speed) ease;
            border-left: 4px solid var(--primary);
            overflow: hidden;
        }

        .article:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .article-content {
            padding: 1rem 1.25rem;
            color: var(--gray-600);
            line-height: 1.6;
        }

        .analysis-summary {
            margin-top: 1rem;
            padding: 1.25rem;
            background: var(--gray-100);
            border-radius: 0.5rem;
            border-left: 3px solid var(--primary);
        }

        .key-findings {
            margin-top: 1rem;
        }

        .finding {
            background: white;
            padding: 1rem;
            margin: 0.75rem 0;
            border-radius: 0.5rem;
            border-left: 3px solid var(--info);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .credibility-score {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.75rem;
            margin-left: 0.75rem;
        }

        .score-high {
            background: var(--success);
            color: white;
        }

        .score-medium {
            background: var(--warning);
            color: white;
        }

        .score-low {
            background: var(--danger);
            color: white;
        }

        /* Social media post styling */
        .social-post-result {
            background: var(--gray-100);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            animation: slideUp 0.3s ease-out;
        }

        .social-post-content {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1.25rem;
            margin: 1rem 0;
            font-family: 'Inter', sans-serif;
        }

        .platform-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .character-count {
            color: var(--gray-500);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .warning-text {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin: 0.75rem 0;
        }

        .copy-button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            margin-top: 0.75rem;
            transition: all var(--transition-speed);
            font-weight: 500;
        }

        .copy-button:hover {
            background: var(--secondary-dark);
            transform: translateY(-1px);
        }

        .post-text {
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        /* Narrative Summary Styling */
        .narrative-summary {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: white;
            border-radius: 0.75rem;
            border-left: 4px solid var(--primary);
        }

        .narrative-content {
            margin-top: 1rem;
            line-height: 1.7;
        }

        .narrative-content p {
            margin-bottom: 1rem;
        }

        .narrative-content strong {
            color: var(--primary);
        }

        .top-sources {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: var(--gray-100);
            border-radius: 0.5rem;
        }

        .top-sources h4 {
            margin-bottom: 0.75rem;
            color: var(--gray-700);
            font-size: 1rem;
        }

        .source-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .source-tag {
            background: var(--primary);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .main-concerns {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: rgba(239, 68, 68, 0.05);
            border-radius: 0.5rem;
            border-left: 4px solid var(--danger);
        }

        .main-concerns h4 {
            margin-bottom: 0.75rem;
            color: var(--danger);
            font-size: 1rem;
        }

        .concerns-list {
            margin-left: 1.25rem;
            color: var(--gray-700);
        }

        .concerns-list li {
            margin-bottom: 0.5rem;
        }

        .summary-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
            text-align: center;
            color: var(--gray-500);
        }

        /* Trusted Sources Display */
        .trusted-sources {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .trusted-sources .source-tag {
            background: var(--info);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Methodology note styling */
        .methodology-note {
            background: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .methodology-note p {
            margin: 0;
            color: var(--primary-dark);
            font-size: 0.9rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-balance-scale"></i> Palestine News Source Verification</h1>
            <p>Cross-referencing news with trusted sources: Reuters, BBC, AP News, Al Jazeera, Palestinian outlets & verified regional sources</p>
        </header>

        <!-- Dashboard Overview -->
        <div class="dashboard-layout">
            <div class="card slide-up">
                <div class="card-header">
                    <h2 class="section-title"><i class="fas fa-chart-line section-icon"></i> Dashboard</h2>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalArticles">0</div>
                            <div class="stat-label">Total Analyzed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="factChecked">0</div>
                            <div class="stat-label">Fact-Checked</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgCredibility">0%</div>
                            <div class="stat-label">Avg Credibility</div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn" onclick="refreshNews()"><i class="fas fa-sync-alt"></i> Refresh News</button>
                    <button class="btn btn-outline" onclick="toggleView()"><i class="fas fa-exchange-alt"></i> Toggle View</button>
                </div>
            </div>

            <div class="card slide-up" style="animation-delay: 0.1s">
                <div class="card-header">
                    <h2 class="section-title"><i class="fas fa-heartbeat section-icon"></i> System Status</h2>
                </div>
                <div class="card-body" id="systemStatus">
                    <div class="status-item">
                        <div class="status-label"><i class="fas fa-server"></i> System:</div>
                        <div class="status-value"><span class="status-indicator" id="systemIndicator"><i class="fas fa-circle" style="color: var(--success)"></i> Online</span></div>
                    </div>
                    <div class="status-item">
                        <div class="status-label"><i class="fas fa-history"></i> Last Update:</div>
                        <div class="status-value" id="lastUpdate">Never</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label"><i class="fas fa-clock"></i> Next Scan:</div>
                        <div class="status-value" id="nextScan">In 6 hours</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- News Summary Section -->
        <div class="card fade-in" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h2 class="section-title"><i class="fas fa-newspaper section-icon"></i> Recent Source Verification Summary</h2>
            </div>
            <div class="card-body">
                <div id="newsSummaryContainer">
                    <div class="loading"><div class="spinner"></div> Loading summary...</div>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn" onclick="refreshSummary()"><i class="fas fa-sync-alt"></i> Refresh Summary</button>
            </div>
        </div>

        <!-- Fact-Checked Articles Section -->
        <div class="card fade-in" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h2 class="section-title"><i class="fas fa-check-circle section-icon"></i> Source-Verified Articles</h2>
            </div>
            <div class="card-body">
                <div class="loading" id="loading" style="display: none;"><div class="spinner"></div> Loading source comparisons...</div>
                <div id="articlesContainer"></div>
            </div>
            <div class="card-footer">
                <button class="btn" onclick="refreshFactChecks()"><i class="fas fa-sync-alt"></i> Refresh Comparisons</button>
            </div>
        </div>

        <!-- Social Media Generator -->
        <div class="card fade-in" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h2 class="section-title"><i class="fas fa-share-alt section-icon"></i> Generate Social Media Posts</h2>
            </div>
            <div class="card-body">
                <p>Create posts about news articles that have been verified against trusted sources</p>
                
                <div class="form-group">
                    <label class="form-label" for="socialArticleSelect">Select Source-Verified Article:</label>
                    <select id="socialArticleSelect" class="form-control form-select">
                        <option value="">Loading verified articles...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="platformSelect">Platform:</label>
                    <select id="platformSelect" class="form-control form-select">
                        <option value="twitter">Twitter</option>
                        <option value="facebook">Facebook</option>
                        <option value="instagram">Instagram</option>
                        <option value="linkedin">LinkedIn</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="toneSelect">Tone:</label>
                    <select id="toneSelect" class="form-control form-select">
                        <option value="informative">Informative</option>
                        <option value="engaging">Engaging</option>
                        <option value="urgent">Urgent</option>
                        <option value="professional">Professional</option>
                    </select>
                </div>
                
                <div id="socialPostResult"></div>
            </div>
            <div class="card-footer">
                <button class="btn btn-outline" onclick="loadSocialReadyArticles()"><i class="fas fa-refresh"></i> Refresh Articles</button>
                <button class="btn" onclick="generateSinglePost()"><i class="fas fa-comment"></i> Generate Single Post</button>
                <button class="btn btn-secondary" onclick="generateMultiplePosts()"><i class="fas fa-comments"></i> Generate All Platforms</button>
            </div>
        </div>

        <!-- Custom Article Analysis -->
        <div class="card fade-in" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h2 class="section-title"><i class="fas fa-search section-icon"></i> Compare Article with Trusted Sources</h2>
            </div>
            <div class="card-body">
                <p>Submit an article to cross-reference with trusted news sources</p>
                <div class="methodology-note">
                    <p><strong><i class="fas fa-info-circle"></i> Our Methodology:</strong> 
                    We prioritize including Palestinian sources and local perspectives alongside international outlets. 
                    Many international sources lack crucial context that only Palestinian journalists and local sources can provide. 
                    This tool aims to highlight these gaps and ensure comprehensive verification.</p>
                </div>
                <form id="analyzeForm">
                    <div class="form-group">
                        <label class="form-label" for="articleUrl">Article URL (optional):</label>
                        <input type="url" id="articleUrl" class="form-control" placeholder="https://example.com/article">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="articleTitle">Article Title:</label>
                        <input type="text" id="articleTitle" class="form-control" placeholder="Enter article title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="articleContent">Article Content:</label>
                        <textarea id="articleContent" class="form-control" placeholder="Paste article content here..." required></textarea>
                    </div>
                    
                    <div id="customAnalysisResult"></div>
                </form>
            </div>
            <div class="card-footer">
                <button type="submit" form="analyzeForm" class="btn btn-secondary"><i class="fas fa-search"></i> Compare with Trusted Sources</button>
            </div>
        </div>
    </div>

    <script>
        let currentView = 'news'; // 'news' or 'factcheck'
        let articlesData = [];
        let factCheckData = [];        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            setupEventListeners();
            loadSocialReadyArticles();
        });

        function setupEventListeners() {
            document.getElementById('analyzeForm').addEventListener('submit', analyzeCustomArticle);
        }        async function loadInitialData() {
            await refreshFactChecks();
            await refreshSummary();
            updateDashboard();
        }

        async function loadSocialReadyArticles() {
            try {
                const response = await fetch('/api/social-ready-articles?limit=20');
                const data = await response.json();
                
                if (data.success) {
                    populateArticleSelect(data.articles);
                }
            } catch (error) {
                console.error('Error loading social-ready articles:', error);
            }
        }

        function populateArticleSelect(articles) {
            const select = document.getElementById('socialArticleSelect');
            
            if (!articles || articles.length === 0) {
                select.innerHTML = '<option value="">No fact-checked articles available</option>';
                return;
            }

            select.innerHTML = '<option value="">Select an article...</option>' +
                articles.map(article => `
                    <option value="${article.id}" data-credibility="${article.credibilityScore}">
                        ${escapeHtml(article.title)} (${Math.round(article.credibilityScore * 100)}%)
                    </option>
                `).join('');
        }

        async function generateSocialPost() {
            const articleId = document.getElementById('socialArticleSelect').value;
            const platform = document.getElementById('platformSelect').value;
            const tone = document.getElementById('toneSelect').value;
            
            if (!articleId) {
                alert('Please select an article first');
                return;
            }

            const resultDiv = document.getElementById('socialPostResult');
            resultDiv.innerHTML = '<div class="loading">Generating social media post...</div>';

            try {
                const response = await fetch('/api/generate-social-post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ articleId, platform, tone })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displaySocialPost(data.socialPost, data.article);
                } else {
                    resultDiv.innerHTML = `<div class="warning-text">Failed to generate post: ${data.error}</div>`;
                }
            } catch (error) {
                console.error('Error generating social post:', error);
                resultDiv.innerHTML = '<div class="warning-text">Failed to generate post. Please try again.</div>';
            }
        }

        async function generateMultiplePosts() {
            const articleId = document.getElementById('socialArticleSelect').value;
            const tone = document.getElementById('toneSelect').value;
            
            if (!articleId) {
                alert('Please select an article first');
                return;
            }

            const resultDiv = document.getElementById('socialPostResult');
            resultDiv.innerHTML = '<div class="loading">Generating posts for all platforms...</div>';

            try {
                const platforms = ['twitter', 'facebook', 'instagram', 'linkedin'];
                const response = await fetch('/api/generate-multiple-posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ articleId, platforms, tone })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayMultipleSocialPosts(data.socialPosts, data.article);
                } else {
                    resultDiv.innerHTML = `<div class="warning-text">Failed to generate posts: ${data.error}</div>`;
                }
            } catch (error) {
                console.error('Error generating multiple posts:', error);
                resultDiv.innerHTML = '<div class="warning-text">Failed to generate posts. Please try again.</div>';
            }
        }

        function displaySocialPost(socialPost, article) {
            const resultDiv = document.getElementById('socialPostResult');
            
            let html = `
                <div class="social-post-result">
                    <h3>📱 Generated Social Media Post</h3>
                    <p><strong>Article:</strong> ${escapeHtml(article.title)}</p>
                    <p><strong>Credibility Score:</strong> ${Math.round(socialPost.credibilityScore * 100)}%</p>
                    
                    <div class="social-post-content">
                        <div class="platform-badge">${socialPost.platform.toUpperCase()}</div>
                        <div class="post-text">${escapeHtml(socialPost.post)}</div>
                        
                        ${socialPost.hashtags && socialPost.hashtags.length > 0 ? `
                            <div class="hashtags">${socialPost.hashtags.join(' ')}</div>
                        ` : ''}
                        
                        <div class="character-count">Characters: ${socialPost.characterCount || socialPost.post.length}</div>
                          ${socialPost.warnings && socialPost.warnings.includeFactCheckWarning ? `
                            <div class="warning-text ${socialPost.warnings.warningLevel ? 'warning-' + socialPost.warnings.warningLevel : ''}">
                                ⚠️ ${socialPost.warnings.warningText || 'This content requires fact-checking verification'}
                            </div>
                        ` : ''}
                        
                        <button class="copy-button" onclick="copyToClipboard('${escapeHtml(socialPost.post + (socialPost.hashtags ? ' ' + socialPost.hashtags.join(' ') : ''))}')">
                            📋 Copy Post
                        </button>
                    </div>
                    
                    ${socialPost.alternativeVersions && socialPost.alternativeVersions.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h4>Alternative Versions:</h4>
                            ${socialPost.alternativeVersions.map(alt => `
                                <div class="social-post-content">
                                    <strong>${alt.style}:</strong><br>
                                    ${escapeHtml(alt.content)}
                                    <button class="copy-button" onclick="copyToClipboard('${escapeHtml(alt.content)}')">
                                        📋 Copy
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                      ${socialPost.visualSuggestions && socialPost.visualSuggestions.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h4>📸 Visual Suggestions:</h4>
                            <ul>
                                ${socialPost.visualSuggestions.map(suggestion => `
                                    <li>${escapeHtml(suggestion)}</li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${socialPost.responsibleSharing ? `
                        <div style="margin-top: 15px;">
                            <h4>🎯 Responsible Sharing Tips:</h4>
                            ${socialPost.responsibleSharing.tips ? `
                                <ul>
                                    ${socialPost.responsibleSharing.tips.map(tip => `
                                        <li>${escapeHtml(tip)}</li>
                                    `).join('')}
                                </ul>
                            ` : ''}
                            ${socialPost.responsibleSharing.verificationSources ? `
                                <p><strong>Verify with these sources:</strong> ${socialPost.responsibleSharing.verificationSources.join(', ')}</p>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }

        function displayMultipleSocialPosts(socialPosts, article) {
            const resultDiv = document.getElementById('socialPostResult');
            
            let html = `
                <div class="social-post-result">
                    <h3>🌐 Generated Social Media Posts</h3>
                    <p><strong>Article:</strong> ${escapeHtml(article.title)}</p>
                    
                    ${Object.entries(socialPosts).map(([platform, post]) => {
                        if (post.error) {
                            return `
                                <div class="social-post-content">
                                    <div class="platform-badge">${platform.toUpperCase()}</div>
                                    <div class="warning-text">Error: ${post.error}</div>
                                </div>
                            `;
                        }
                        
                        return `
                            <div class="social-post-content">
                                <div class="platform-badge">${platform.toUpperCase()}</div>
                                <div class="post-text">${escapeHtml(post.post)}</div>
                                
                                ${post.hashtags && post.hashtags.length > 0 ? `
                                    <div class="hashtags">${post.hashtags.join(' ')}</div>
                                ` : ''}
                                
                                <div class="character-count">Characters: ${post.characterCount || post.post.length}</div>
                                  ${post.warnings && post.warnings.includeFactCheckWarning ? `
                                    <div class="warning-text ${post.warnings.warningLevel ? 'warning-' + post.warnings.warningLevel : ''}">
                                        ⚠️ ${post.warnings.warningText || 'This content requires fact-checking verification'}
                                    </div>
                                ` : ''}
                                
                                <button class="copy-button" onclick="copyToClipboard('${escapeHtml(post.post + (post.hashtags ? ' ' + post.hashtags.join(' ') : ''))}')">
                                    📋 Copy Post
                                </button>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }

        function copyToClipboard(text) {
            // Remove HTML escaping for clipboard
            const textarea = document.createElement('textarea');
            textarea.value = text.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            // Show feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '✅ Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }

        async function refreshNews() {
            // Redirect to refreshing fact checks since we removed news
            await refreshFactChecks();
        }

        async function refreshFactChecks() {
            try {
                const response = await fetch('/api/fact-check');
                const data = await response.json();
                
                if (data.success) {
                    factCheckData = data.results;
                    displayFactChecks(factCheckData);
                    updateDashboard();
                    // Also refresh the social media article list
                    loadSocialReadyArticles();
                }
            } catch (error) {
                console.error('Error fetching fact-checks:', error);
            }
        }

        // News Summary Functions
        async function refreshSummary() {
            const container = document.getElementById('newsSummaryContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading summary...</div>';
            
            try {
                const response = await fetch('/api/fact-check');
                const data = await response.json();
                
                if (data.success && data.results && data.results.length > 0) {
                    displayNewsSummary(data.results);
                } else {
                    container.innerHTML = '<p>No recent news analysis available yet.</p>';
                }
            } catch (error) {
                console.error('Error fetching news summary:', error);
                container.innerHTML = '<div class="warning-text">Failed to load summary</div>';
            }
        }

        function displayNewsSummary(factCheckData) {
            const container = document.getElementById('newsSummaryContainer');
            
            if (!factCheckData || factCheckData.length === 0) {
                container.innerHTML = '<p>No recent news analysis available yet.</p>';
                return;
            }

            // Get recent articles (last 24-48 hours)
            const now = new Date();
            const recentArticles = factCheckData.filter(article => {
                const articleDate = new Date(article.processedAt);
                const hoursDiff = (now - articleDate) / (1000 * 60 * 60);
                return hoursDiff <= 48; // Last 48 hours
            }).slice(0, 10);

            // Calculate summary statistics
            const totalAnalyzed = factCheckData.length;
            const recentAnalyzed = recentArticles.length;
            const verifiedCount = recentArticles.filter(a => 
                (a.analysis.overallAssessment || '').toLowerCase().includes('verified') || 
                (a.analysis.finalScore || a.analysis.credibilityScore || 0) >= 0.7
            ).length;
            const disputedCount = recentArticles.filter(a => 
                (a.analysis.overallAssessment || '').toLowerCase().includes('disputed') ||
                (a.analysis.redFlags && a.analysis.redFlags.length > 0)
            ).length;
            const avgCredibility = recentArticles.length > 0 
                ? Math.round(recentArticles.reduce((sum, a) => sum + (a.analysis.finalScore || a.analysis.credibilityScore || 0), 0) / recentArticles.length * 100)
                : 0;

            // Generate narrative summary
            let narrative = generateNarrativeSummary(recentArticles, verifiedCount, disputedCount, avgCredibility);

            // Get top sources
            const sources = {};
            recentArticles.forEach(article => {
                const source = article.source || 'Unknown';
                sources[source] = (sources[source] || 0) + 1;
            });
            const topSources = Object.entries(sources)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([source]) => source);

            // Get main topics/concerns
            const allRedFlags = recentArticles
                .filter(a => a.analysis.redFlags && a.analysis.redFlags.length > 0)
                .flatMap(a => a.analysis.redFlags)
                .slice(0, 5);

            let html = `
                <div class="news-summary">
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="summary-stat-number">${recentAnalyzed}</div>
                            <div class="summary-stat-label">Recent Articles</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-number">${verifiedCount}</div>
                            <div class="summary-stat-label">Verified</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-number">${disputedCount}</div>
                            <div class="summary-stat-label">Disputed</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-number">${avgCredibility}%</div>
                            <div class="summary-stat-label">Avg Credibility</div>
                        </div>
                    </div>
                    
                    <div class="narrative-summary">
                        <h3><i class="fas fa-chart-line"></i> What's Happening</h3>
                        <div class="narrative-content">
                            ${narrative}
                        </div>
                    </div>

                    ${topSources.length > 0 ? `
                        <div class="top-sources">
                            <h4><i class="fas fa-globe"></i> Top Sources</h4>
                            <div class="source-tags">
                                ${topSources.map(source => `
                                    <span class="source-tag">${escapeHtml(source)}</span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${allRedFlags.length > 0 ? `
                        <div class="main-concerns">
                            <h4><i class="fas fa-exclamation-triangle"></i> Main Concerns Identified</h4>
                            <ul class="concerns-list">
                                ${allRedFlags.map(flag => `
                                    <li>${escapeHtml(flag)}</li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <div class="summary-footer">
                        <small><i class="fas fa-clock"></i> Last updated: ${new Date().toLocaleString()}</small>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function generateNarrativeSummary(articles, verifiedCount, disputedCount, avgCredibility) {
            if (articles.length === 0) {
                return '<p>No recent news articles have been analyzed in the past 48 hours.</p>';
            }

            let summary = `<p>In the past 48 hours, we have cross-referenced <strong>${articles.length} news articles</strong> with trusted sources including international outlets (Reuters, BBC, AP News), regional sources (Al Jazeera), Palestinian news outlets, and verified local sources to ensure comprehensive perspective. `;

            if (avgCredibility >= 70) {
                summary += `Most reporting shows consistency across diverse sources (${avgCredibility}% average match), indicating reliable information from multiple perspectives including Palestinian sources.`;
            } else if (avgCredibility >= 50) {
                summary += `There are discrepancies between different source perspectives (${avgCredibility}% average match), highlighting the importance of consulting Palestinian and regional sources alongside international outlets.`;
            } else {
                summary += `Significant differences found across source perspectives (${avgCredibility}% average match), underscoring the critical need to include Palestinian voices and local sources in verification.`;
            }
            summary += '</p>';

            if (verifiedCount > 0) {
                summary += `<p><strong>${verifiedCount} articles</strong> show consistency across international, regional, and Palestinian sources. `;
            }

            if (disputedCount > 0) {
                summary += `<strong>${disputedCount} articles</strong> show significant differences between international and Palestinian/regional source reporting. `;
            }

            if (disputedCount === 0 && verifiedCount === articles.length) {
                summary += 'All recent articles show alignment across diverse source perspectives including Palestinian outlets.</p>';
            } else if (disputedCount > verifiedCount) {
                summary += `<strong>Exercise caution</strong> - ${Math.round((disputedCount/articles.length)*100)}% of articles show major discrepancies, often missing Palestinian perspectives or contradicting local sources.</p>`;
            } else {
                summary += 'Most information aligns across sources, but always consult Palestinian and regional outlets for complete context.</p>';
            }

            // Add specific note about Palestinian source importance
            summary += '<p><em>Note: This verification emphasizes the importance of including Palestinian sources and perspectives, as international coverage often lacks crucial local context and firsthand accounts.</em></p>';

            return summary;
        }

        function extractTopics(articles) {
            // Simple keyword extraction from titles
            const keywords = {};
            articles.forEach(article => {
                const title = (article.title || '').toLowerCase();
                const words = title.split(/\s+/).filter(word => 
                    word.length > 4 && 
                    !['about', 'israel', 'palestine', 'palestinian', 'news', 'report', 'says'].includes(word)
                );
                words.forEach(word => {
                    keywords[word] = (keywords[word] || 0) + 1;
                });
            });

            return Object.entries(keywords)
                .filter(([_, count]) => count >= 2)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([word]) => word);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function getScoreClass(score) {
            if (score >= 0.7) return 'score-high';
            if (score >= 0.4) return 'score-medium';
            return 'score-low';
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            try {
                return new Date(dateString).toLocaleDateString();
            } catch {
                return 'Unknown';
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Tab switching functionality
        function switchTab(tabName, element) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active class to clicked tab
            element.classList.add('active');
            
            // Update current view
            currentView = tabName;
            
            // Update content based on tab
            const title = document.getElementById('currentViewTitle');
            if (tabName === 'news') {
                title.innerHTML = '<i class="fas fa-newspaper section-icon"></i> Latest Palestine News';
                displayArticles(articlesData);
            } else if (tabName === 'factcheck') {
                title.innerHTML = '✅ Fact-Check Results';
                displayFactChecks(factCheckData);
            }
        }

        // Alias functions for backwards compatibility
        function generateSinglePost() {
            generateSocialPost();
        }

        function generateMultiplePosts() {
            generateMultiplePosts();
        }

        // Enhanced loading function with modern spinner
        function showLoadingWithMessage(show, message = 'Loading...') {
            const loadingElement = document.getElementById('loading');
            if (show) {
                loadingElement.innerHTML = `<div class="spinner"></div> ${message}`;
                loadingElement.style.display = 'flex';
            } else {
                loadingElement.style.display = 'none';
            }
        }

        // Enhanced article display with modern cards
        function displayArticlesModern(articles) {
            const container = document.getElementById('articlesContainer');
            
            if (!articles || articles.length === 0) {
                container.innerHTML = `
                    <div class="article-card">
                        <div class="article-header">
                            <div class="article-title">No Articles Found</div>
                            <p>The scraper may still be collecting data. Try refreshing in a few minutes.</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = articles.map((article, index) => `
                <div class="article-card fade-in" style="animation-delay: ${index * 0.1}s">
                    <div class="article-header">
                        <div class="article-title">${escapeHtml(article.title)}</div>
                        <div class="article-meta">
                            <span class="badge badge-primary">
                                <i class="fas fa-globe"></i> ${escapeHtml(article.source)}
                            </span>
                            <span class="badge badge-info">
                                <i class="fas fa-calendar"></i> ${formatDate(article.publishedDate)}
                            </span>
                            ${article.sourceCredibility ? `
                                <span class="badge ${getCredibilityBadgeClass(article.sourceCredibility)}">
                                    <i class="fas fa-shield-alt"></i> ${Math.round(article.sourceCredibility * 100)}%
                                </span>
                            ` : ''}
                        </div>
                    </div>
                    <div class="article-body">
                        <div class="article-content">
                            ${escapeHtml(article.content ? article.content.substring(0, 300) + '...' : 'Content not available')}
                        </div>
                    </div>
                    <div class="article-footer">
                        <span class="char-count">${article.content ? article.content.length : 0} characters</span>
                        ${article.url ? `
                            <a href="${article.url}" target="_blank" class="btn btn-outline">
                                <i class="fas fa-external-link-alt"></i> Read Full Article
                            </a>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Enhanced fact-check display with modern cards
        function displayFactChecksModern(factChecks) {
            const container = document.getElementById('articlesContainer');
            
            if (!factChecks || factChecks.length === 0) {
                container.innerHTML = `
                    <div class="article-card">
                        <div class="article-header">
                            <div class="article-title">No Source Comparisons Available</div>
                            <p>No articles have been cross-referenced with trusted sources yet. Check back soon for verification results.</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = factChecks.map((item, index) => `
                <div class="article-card fade-in" style="animation-delay: ${index * 0.1}s">
                    <div class="article-header">
                        <div class="article-title">${escapeHtml(item.title)}</div>
                        <div class="article-meta">
                            <span class="badge badge-primary">
                                <i class="fas fa-globe"></i> ${escapeHtml(item.source)}
                            </span>
                            <span class="badge badge-info">
                                <i class="fas fa-clock"></i> ${formatDate(item.processedAt)}
                            </span>
                            <span class="badge ${getCredibilityBadgeClass(item.analysis.finalScore || item.analysis.credibilityScore)}">
                                <i class="fas fa-balance-scale"></i> ${Math.round((item.analysis.finalScore || item.analysis.credibilityScore) * 100)}% Match
                            </span>
                        </div>
                        <div class="credential-meter">
                            <div class="credential-fill ${getCredentialClass(item.analysis.finalScore || item.analysis.credibilityScore)}" 
                                 style="width: ${(item.analysis.finalScore || item.analysis.credibilityScore) * 100}%"></div>
                        </div>
                    </div>
                    
                    <div class="article-body">
                        <div class="analysis-summary">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                                <strong><i class="fas fa-search"></i> Source Comparison Result:</strong> 
                                <span class="verification-status ${(item.analysis.overallAssessment || 'unverified').toLowerCase()}">
                                    ${getSourceComparisonStatus(item.analysis.overallAssessment)}
                                </span>
                            </div>
                            
                            ${item.analysis.trustedSources || item.analysis.sources ? `
                                <div style="margin-bottom: 1rem;">
                                    <strong><i class="fas fa-shield-check"></i> Compared Against:</strong>
                                    <div class="trusted-sources">
                                        ${getTrustedSourcesList(item.analysis.trustedSources || item.analysis.sources)}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${item.analysis.recommendations ? `
                                <div style="margin-bottom: 1rem;">
                                    <strong><i class="fas fa-lightbulb"></i> Based on Source Comparison:</strong>
                                    <p style="margin-top: 0.5rem; color: var(--gray-600);">${escapeHtml(item.analysis.recommendations)}</p>
                                </div>
                            ` : ''}
                            
                            ${item.analysis.keyFindings && item.analysis.keyFindings.length > 0 ? `
                                <div class="key-findings">
                                    <strong><i class="fas fa-balance-scale"></i> Source Comparison Findings:</strong>
                                    ${item.analysis.keyFindings.slice(0, 3).map(finding => `
                                        <div class="finding">
                                            <div style="margin-bottom: 0.5rem;">
                                                <strong>Claim:</strong> ${escapeHtml(finding.claim || 'N/A')}
                                            </div>
                                            <div style="margin-bottom: 0.5rem;">
                                                <strong>Trusted Source Status:</strong> 
                                                <span class="verification-status ${(finding.verification || 'unverified').toLowerCase()}">
                                                    ${getSourceVerificationText(finding.verification)}
                                                </span>
                                            </div>
                                            <div>
                                                <strong>Found in Trusted Sources:</strong> ${escapeHtml(finding.evidence || 'No matching information found in trusted sources')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            ${item.analysis.redFlags && item.analysis.redFlags.length > 0 ? `
                                <div class="warning-box warning-high">
                                    <i class="fas fa-exclamation-triangle warning-icon"></i>
                                    <div>
                                        <strong>Discrepancies with Trusted Sources:</strong>
                                        <ul style="margin-top: 0.5rem; margin-left: 1rem;">
                                            ${item.analysis.redFlags.map(flag => `<li>${escapeHtml(flag)}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="article-footer">
                        <span class="char-count">Cross-referenced ${formatDate(item.processedAt)}</span>
                        ${item.url ? `
                            <a href="${item.url}" target="_blank" class="btn btn-outline">
                                <i class="fas fa-external-link-alt"></i> Read Original
                            </a>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Helper functions for styling
        function getCredibilityBadgeClass(score) {
            if (score >= 0.7) return 'badge-success';
            if (score >= 0.4) return 'badge-warning';
            return 'badge-danger';
        }

        function getCredentialClass(score) {
            if (score >= 0.7) return 'credential-high';
            if (score >= 0.4) return 'credential-medium';
            return 'credential-low';
        }

        // Update the existing display functions to use modern versions
        function displayArticles(articles) {
            displayArticlesModern(articles);
        }

        function displayFactChecks(factChecks) {
            displayFactChecksModern(factChecks);
        }

        // Initialize with proper tab state
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial tab state
            switchTab('news', document.querySelector('.tab.active'));
            loadInitialData();
            setupEventListeners();
            loadSocialReadyArticles();
            
            // Add smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';
        });

        // Add notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                </div>
            `;
            
            // Add notification styles
            notification.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--info)'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                box-shadow: var(--card-shadow);
                z-index: 1000;
                animation: slideDown 0.3s ease-out;
                max-width: 400px;
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Add CSS for notifications
        const notificationStyles = document.createElement('style');
        notificationStyles.textContent = `
            @keyframes slideDown {
                from { transform: translateY(-100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translateY(0); opacity: 1; }
                to { transform: translateY(-100%); opacity: 0; }
            }
        `;
        document.head.appendChild(notificationStyles);

        // Remove tab switching functions since we no longer need them
        function toggleView() {
            // Keep for backward compatibility but make it refresh fact checks
            refreshFactChecks();
        }

        function updateDashboard() {
            const totalFactChecked = factCheckData.length;
            document.getElementById('totalArticles').textContent = totalFactChecked;
            document.getElementById('factChecked').textContent = totalFactChecked;
            
            if (factCheckData.length > 0) {
                const avgScore = factCheckData.reduce((sum, item) => 
                    sum + (item.analysis.finalScore || item.analysis.credibilityScore || 0), 0) / factCheckData.length;
                document.getElementById('avgCredibility').textContent = Math.round(avgScore * 100) + '%';
            }
            
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }

        // Keep the remaining functions
        async function analyzeCustomArticle(event) {
            event.preventDefault();
            
            const url = document.getElementById('articleUrl').value;
            const title = document.getElementById('articleTitle').value;
            const content = document.getElementById('articleContent').value;
            
            if (!title || !content) {
                showNotification('Please provide both title and content', 'error');
                return;
            }
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url, title, content })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayCustomAnalysis(data.analysis);
                    showNotification('Article analysis completed successfully!', 'success');
                } else {
                    showNotification('Analysis failed: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error analyzing article:', error);
                showNotification('Analysis failed. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        function displayCustomAnalysis(analysis) {
            const container = document.getElementById('customAnalysisResult');
            
            container.innerHTML = `
                <div class="analysis-summary" style="margin-top: 20px;">
                    <h3><i class="fas fa-chart-bar"></i> Analysis Results</h3>
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <strong>Overall Assessment:</strong> 
                        <span class="verification-status ${(analysis.overallAssessment || 'unverified').toLowerCase()}">
                            ${analysis.overallAssessment || 'Unverified'}
                        </span>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Credibility Score:</strong> 
                        <span class="badge ${getCredibilityBadgeClass(analysis.finalScore || analysis.credibilityScore)}">
                            ${Math.round((analysis.finalScore || analysis.credibilityScore) * 100)}%
                        </span>
                        <div class="credential-meter">
                            <div class="credential-fill ${getCredentialClass(analysis.finalScore || analysis.credibilityScore)}" 
                                 style="width: ${(analysis.finalScore || analysis.credibilityScore) * 100}%"></div>
                        </div>
                    </div>
                    
                    ${analysis.recommendations ? `
                        <div style="margin-bottom: 1rem;">
                            <strong><i class="fas fa-lightbulb"></i> Recommendations:</strong>
                            <p style="margin-top: 0.5rem; color: var(--gray-600);">${escapeHtml(analysis.recommendations)}</p>
                        </div>
                    ` : ''}
                    
                    ${analysis.keyFindings && analysis.keyFindings.length > 0 ? `
                        <div class="key-findings">
                            <strong><i class="fas fa-search"></i> Key Findings:</strong>
                            ${analysis.keyFindings.map(finding => `
                                <div class="finding">
                                    <div style="margin-bottom: 0.5rem;">
                                        <strong>Claim:</strong> ${escapeHtml(finding.claim || 'N/A')}
                                    </div>
                                    <div style="margin-bottom: 0.5rem;">
                                        <strong>Status:</strong> 
                                        <span class="verification-status ${(finding.verification || 'unverified').toLowerCase()}">
                                            ${finding.verification || 'Unverified'}
                                        </span>
                                    </div>
                                    <div>
                                        <strong>Evidence:</strong> ${escapeHtml(finding.evidence || 'No evidence provided')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${analysis.redFlags && analysis.redFlags.length > 0 ? `
                        <div class="warning-box warning-high">
                            <i class="fas fa-exclamation-triangle warning-icon"></i>
                            <div>
                                <strong>Red Flags:</strong>
                                <ul style="margin-top: 0.5rem; margin-left: 1rem;">
                                    ${analysis.redFlags.map(flag => `<li>${escapeHtml(flag)}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Helper functions for source comparison display
        function getSourceComparisonStatus(assessment) {
            if (!assessment) return 'Not Yet Compared';
            if (assessment.toLowerCase().includes('verified')) return 'Matches Trusted Sources';
            if (assessment.toLowerCase().includes('disputed')) return 'Contradicts Trusted Sources';
            return assessment;
        }

        function getSourceVerificationText(verification) {
            if (!verification) return 'Not found in trusted sources';
            if (verification.toLowerCase().includes('verified')) return 'Confirmed by trusted sources';
            if (verification.toLowerCase().includes('disputed')) return 'Contradicted by trusted sources';
            return verification;
        }

        function getTrustedSourcesList(sources) {
            if (!sources) return '<span class="source-tag">Reuters</span><span class="source-tag">BBC</span><span class="source-tag">AP News</span><span class="source-tag">Al Jazeera</span><span class="source-tag">Palestinian outlets</span>';
            if (typeof sources === 'string') {
                return sources.split(',').map(source => 
                    `<span class="source-tag">${escapeHtml(source.trim())}</span>`
                ).join('');
            }
            if (Array.isArray(sources)) {
                return sources.map(source => 
                    `<span class="source-tag">${escapeHtml(source)}</span>`
                ).join('');
            }
            return '<span class="source-tag">Reuters</span><span class="source-tag">BBC</span><span class="source-tag">AP News</span><span class="source-tag">Al Jazeera</span>';
        }
    </script>
</body>
</html>
